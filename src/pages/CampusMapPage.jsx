import { useEffect } from "react";
import { useNavigate } from "react-router-dom";

export default function CampusMapPage() {
  const navigate = useNavigate();

  useEffect(() => {
    const handleMessage = (e) => {
      if (e.data && e.data.nav) {
        navigate(e.data.nav);
      }
    };
    window.addEventListener("message", handleMessage);
    return () => window.removeEventListener("message", handleMessage);
  }, [navigate]);

  const html = "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover\">\n  <title>Interactive Campus Map - IIT Bombay | Smart Move</title>\n  <meta name=\"description\" content=\"Explore IIT Bombay campus - locations, features and facilities\">\n  <meta name=\"theme-color\" content=\"#8B4513\">\n\n  <link href=\"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Montserrat:wght@600;700;800&display=swap\" rel=\"stylesheet\">\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n  <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" integrity=\"sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=\" crossorigin=\"\">\n\n  <style>\n    :root {\n      --earth-brown: #8B4513;\n      --deep-earth: #654321;\n      --terracotta: #E07A5F;\n      --sand: #F4A261;\n      --sage: #81B29A;\n      --forest: #3D5A40;\n      --clay: #D4A574;\n      --stone: #A8A196;\n      --cream: #F9F5F0;\n      --charcoal: #2D3142;\n      --white: #FFFFFF;\n    }\n\n    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }\n\n    body {\n      font-family: 'Poppins', sans-serif;\n      overflow-x: hidden;\n      background: #1a1a1a;\n      min-height: 100vh;\n      position: relative;\n    }\n\n    .background-wrapper {\n      position: fixed;\n      top: 0; left: 0; width: 100%; height: 100%;\n      z-index: 0;\n      overflow: hidden;\n    }\n\n    .background-image {\n      width: 100%; height: 100%;\n      object-fit: cover;\n      object-position: center;\n    }\n\n    .background-overlay {\n      position: absolute;\n      top: 0; left: 0; width: 100%; height: 100%;\n      background: linear-gradient(135deg, rgba(139, 69, 19, 0.88) 0%, rgba(101, 67, 33, 0.78) 50%, rgba(61, 90, 64, 0.88) 100%);\n      backdrop-filter: blur(3px);\n    }\n\n    .header {\n      position: fixed;\n      top: 0; left: 0; right: 0;\n      height: 90px;\n      background: rgba(255, 255, 255, 0.15);\n      backdrop-filter: blur(25px);\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n      z-index: 1000;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 0 50px;\n      border-bottom: 3px solid rgba(212, 165, 116, 0.3);\n    }\n\n    .logo-section { display: flex; align-items: center; gap: 18px; }\n\n    .logo-icon {\n      width: 60px; height: 60px;\n      background: linear-gradient(135deg, var(--earth-brown), var(--terracotta));\n      border-radius: 15px;\n      display: flex; align-items: center; justify-content: center;\n      box-shadow: 0 8px 25px rgba(139, 69, 19, 0.5), inset 0 -3px 10px rgba(0, 0, 0, 0.3);\n    }\n\n    .logo-icon i { font-size: 28px; color: white; filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3)); }\n\n    .logo-text h1 {\n      font-family: 'Montserrat', sans-serif;\n      font-size: 28px;\n      font-weight: 800;\n      color: white;\n      letter-spacing: -0.5px;\n      text-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);\n      background: linear-gradient(135deg, #fff, var(--clay));\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      background-clip: text;\n    }\n\n    .logo-text p { font-size: 12px; color: rgba(255, 255, 255, 0.8); font-weight: 600; text-transform: uppercase; letter-spacing: 2px; }\n\n    .nav-back {\n      padding: 12px 24px;\n      background: rgba(255, 255, 255, 0.2);\n      border: 2px solid rgba(255, 255, 255, 0.4);\n      border-radius: 50px;\n      color: white;\n      font-weight: 600;\n      text-decoration: none;\n      transition: all 0.3s ease;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .nav-back:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3); color: white; }\n\n    .main-container {\n      position: relative;\n      width: 100%;\n      min-height: 100vh;\n      padding: 110px 50px 60px;\n      z-index: 1;\n    }\n\n    .page-hero { text-align: center; margin-bottom: 32px; }\n    .page-hero h1 {\n      font-family: 'Montserrat', sans-serif;\n      font-size: 42px;\n      font-weight: 800;\n      color: white;\n      text-shadow: 0 5px 20px rgba(0, 0, 0, 0.6);\n      margin-bottom: 10px;\n      letter-spacing: -1px;\n    }\n    .page-hero .subtitle { font-size: 18px; color: rgba(255, 255, 255, 0.9); max-width: 640px; margin: 0 auto; }\n\n    .map-search-card {\n      max-width: 1000px;\n      margin: 0 auto 28px;\n      background: rgba(255, 255, 255, 0.12);\n      backdrop-filter: blur(25px);\n      border-radius: 24px;\n      padding: 28px 32px;\n      border: 2px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);\n    }\n\n    .search-wrap {\n      position: relative;\n      display: flex;\n      gap: 12px;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n\n    .search-wrap i.fa-search {\n      position: absolute;\n      left: 20px;\n      top: 50%;\n      transform: translateY(-50%);\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 18px;\n      pointer-events: none;\n    }\n\n    .search-wrap input {\n      flex: 1;\n      min-width: 220px;\n      padding: 16px 20px 16px 52px;\n      border: 2px solid rgba(255, 255, 255, 0.3);\n      border-radius: 16px;\n      background: rgba(255, 255, 255, 0.1);\n      color: white;\n      font-size: 16px;\n      font-family: 'Poppins', sans-serif;\n      transition: all 0.3s ease;\n    }\n\n    .search-wrap input::placeholder { color: rgba(255, 255, 255, 0.55); }\n    .search-wrap input:focus {\n      outline: none;\n      border-color: var(--terracotta);\n      background: rgba(255, 255, 255, 0.15);\n      box-shadow: 0 0 0 4px rgba(224, 122, 95, 0.2);\n    }\n\n    .filter-tags {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 8px;\n      margin-top: 16px;\n      align-items: center;\n    }\n\n    .filter-tags span { font-size: 13px; color: rgba(255, 255, 255, 0.8); margin-right: 4px; }\n    .filter-tag {\n      padding: 8px 16px;\n      background: rgba(255, 255, 255, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.3);\n      border-radius: 20px;\n      color: white;\n      font-size: 13px;\n      cursor: pointer;\n      transition: all 0.25s ease;\n      font-family: 'Poppins', sans-serif;\n    }\n    .filter-tag:hover, .filter-tag.active {\n      background: rgba(255, 255, 255, 0.25);\n      border-color: var(--terracotta);\n    }\n\n    .map-3d-wrap {\n      max-width: 1000px;\n      margin: 0 auto 28px;\n      border-radius: 24px;\n      overflow: hidden;\n      border: 2px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);\n      background: #1e3a32;\n      min-height: 320px;\n    }\n\n    #map {\n      width: 100%;\n      height: 320px;\n      background: #2d5a4a;\n    }\n\n    .directions-card { margin-bottom: 20px; }\n    .directions-row { display: flex; flex-wrap: wrap; gap: 16px; align-items: flex-end; }\n    .direction-field { flex: 1; min-width: 200px; }\n    .direction-field label { display: block; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.8); margin-bottom: 6px; font-weight: 600; }\n    .direction-select {\n      width: 100%;\n      padding: 14px 18px;\n      border: 2px solid rgba(255, 255, 255, 0.3);\n      border-radius: 16px;\n      background: rgba(255, 255, 255, 0.1);\n      color: white;\n      font-size: 15px;\n      font-family: 'Poppins', sans-serif;\n      cursor: pointer;\n      transition: all 0.3s ease;\n    }\n    .direction-select:focus { outline: none; border-color: var(--terracotta); background: rgba(255, 255, 255, 0.15); }\n    .direction-select option { background: var(--charcoal); color: white; }\n\n    .leaflet-control-zoom a { background: rgba(255,255,255,0.2) !important; color: white !important; }\n    .leaflet-control-attribution { background: rgba(0,0,0,0.5) !important; color: rgba(255,255,255,0.7) !important; font-size: 10px; }\n\n    .results-count {\n      max-width: 1000px;\n      margin: 0 auto 14px;\n      font-size: 15px;\n      color: rgba(255, 255, 255, 0.85);\n    }\n\n    .place-cards {\n      max-width: 1000px;\n      margin: 0 auto;\n      display: grid;\n      gap: 22px;\n    }\n\n    .place-card {\n      background: rgba(255, 255, 255, 0.12);\n      backdrop-filter: blur(25px);\n      border-radius: 24px;\n      padding: 28px 32px;\n      border: 2px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n      transition: all 0.35s ease;\n      cursor: pointer;\n      transform-style: preserve-3d;\n      perspective: 1000px;\n    }\n\n    .place-card:hover {\n      background: rgba(255, 255, 255, 0.18);\n      border-color: rgba(255, 255, 255, 0.35);\n      transform: translateY(-6px);\n      box-shadow: 0 24px 56px rgba(0, 0, 0, 0.45), 0 0 40px rgba(224, 122, 95, 0.15);\n    }\n\n    .place-card h3 {\n      font-family: 'Montserrat', sans-serif;\n      font-size: 22px;\n      font-weight: 700;\n      color: white;\n      margin-bottom: 10px;\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);\n    }\n\n    .place-card h3 .icon-wrap {\n      width: 44px;\n      height: 44px;\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n    }\n\n    .place-card h3 .icon-wrap i { color: white; font-size: 20px; }\n\n    .place-card .location {\n      font-size: 14px;\n      color: var(--sand);\n      margin-bottom: 12px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .place-card .location i { opacity: 0.9; }\n\n    .place-card .desc {\n      font-size: 15px;\n      color: rgba(255, 255, 255, 0.88);\n      line-height: 1.65;\n      margin-bottom: 16px;\n    }\n\n    .place-card .meta {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 10px;\n      margin-bottom: 14px;\n    }\n\n    .meta-pill {\n      padding: 6px 14px;\n      background: rgba(255, 255, 255, 0.15);\n      border-radius: 20px;\n      font-size: 12px;\n      color: rgba(255, 255, 255, 0.95);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n    }\n\n    .place-card .available-title {\n      font-size: 12px;\n      text-transform: uppercase;\n      letter-spacing: 1px;\n      color: rgba(255, 255, 255, 0.7);\n      margin-bottom: 8px;\n      font-weight: 600;\n    }\n\n    .place-card .available-list {\n      font-size: 14px;\n      color: rgba(255, 255, 255, 0.9);\n      line-height: 1.6;\n    }\n\n    .no-results {\n      max-width: 1000px;\n      margin: 0 auto;\n      text-align: center;\n      padding: 50px 24px;\n      background: rgba(255, 255, 255, 0.08);\n      border-radius: 24px;\n      border: 2px dashed rgba(255, 255, 255, 0.2);\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 16px;\n    }\n\n    @media (max-width: 768px) {\n      .header { padding: 0 20px; height: 80px; }\n      .logo-text h1 { font-size: 22px; }\n      .main-container { padding: 95px 20px 40px; }\n      .page-hero h1 { font-size: 30px; }\n      .map-search-card { padding: 20px; }\n      .place-card { padding: 22px; }\n      .place-card h3 { font-size: 19px; }\n      #map { height: 260px; }\n    }\n  </style>\n</head>\n<body>\n\n  <div class=\"background-wrapper\">\n    <img src=\"https://images.unsplash.com/photo-1562774053-701939374585?q=80&w=2000\" alt=\"Campus\" class=\"background-image\">\n    <div class=\"background-overlay\"></div>\n  </div>\n\n  <header class=\"header\">\n    <div class=\"logo-section\">\n      <div class=\"logo-icon\">\n        <i class=\"fas fa-map-marked-alt\"></i>\n      </div>\n      <div class=\"logo-text\">\n        <h1>Smart Move</h1>\n        <p>Interactive Campus Map</p>\n      </div>\n    </div>\n    <a href=\"#\" onclick=\"window.parent.postMessage({nav:'/landing'},'*');return false;\" class=\"nav-back\">\n      <i class=\"fas fa-arrow-left\"></i> Back to Home\n    </a>\n  </header>\n\n  <main class=\"main-container\">\n    <div class=\"page-hero\">\n      <h1>Interactive Campus Map</h1>\n      <p class=\"subtitle\">Search locations and see features, facilities and what\u2019s available at each place across IIT Bombay.</p>\n    </div>\n\n    <div class=\"map-search-card\">\n      <div class=\"search-wrap\">\n        <i class=\"fas fa-search\"></i>\n        <input type=\"text\" id=\"searchInput\" placeholder=\"Search by name, location, feature or facility...\" autocomplete=\"off\">\n      </div>\n      <div class=\"filter-tags\">\n        <span>Filter:</span>\n        <button type=\"button\" class=\"filter-tag active\" data-filter=\"\">All</button>\n        <button type=\"button\" class=\"filter-tag\" data-filter=\"academic\">Academic</button>\n        <button type=\"button\" class=\"filter-tag\" data-filter=\"hostel\">Hostel</button>\n        <button type=\"button\" class=\"filter-tag\" data-filter=\"recreation\">Recreation</button>\n        <button type=\"button\" class=\"filter-tag\" data-filter=\"admin\">Admin</button>\n        <button type=\"button\" class=\"filter-tag\" data-filter=\"food\">Food</button>\n        <button type=\"button\" class=\"filter-tag\" data-filter=\"research\">Research</button>\n      </div>\n    </div>\n\n    <!-- Directions (React map feature): source/destination + route on map -->\n    <div class=\"directions-card map-search-card\">\n      <div class=\"directions-row\">\n        <div class=\"direction-field\">\n          <label>From</label>\n          <select id=\"dirSource\" class=\"direction-select\">\n            <option value=\"\">Select source...</option>\n          </select>\n        </div>\n        <div class=\"direction-field\">\n          <label>To</label>\n          <select id=\"dirDest\" class=\"direction-select\">\n            <option value=\"\">Select destination...</option>\n          </select>\n        </div>\n        <button type=\"button\" id=\"clearRouteBtn\" class=\"nav-back\" style=\"display:none; margin-top:22px; padding:10px 20px;\">Clear route</button>\n      </div>\n    </div>\n\n    <div class=\"map-3d-wrap\">\n      <div id=\"map\"></div>\n    </div>\n\n    <p class=\"results-count\" id=\"resultsCount\"></p>\n    <div class=\"place-cards\" id=\"placeCards\"></div>\n    <div class=\"no-results\" id=\"noResults\" style=\"display:none;\">No places match your search. Try another keyword or filter.</div>\n  </main>\n\n  <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\" integrity=\"sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=\" crossorigin=\"\"></script>\n  <script src=\"https://cdn.jsdelivr.net/npm/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.min.js\"></script>\n  <script>\n    const IIT_CENTER = { lat: 19.1334, lng: 72.9133 };\n    const CAMPUS_BOUNDS = [[19.125, 72.905], [19.142, 72.922]];\n\n    // Colored markers by type (same as React IITBmap)\n    const MARKER_COLORS = { academic: 'red', hostel: 'blue', food: 'green', recreation: 'orange', admin: 'orange', research: 'orange', facility: 'orange' };\n    function createIcon(type) {\n      var color = MARKER_COLORS[type] || 'orange';\n      return L.icon({\n        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-' + color + '.png',\n        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n        iconSize: [25, 41],\n        iconAnchor: [12, 41]\n      });\n    }\n\n    const campusPlaces = [\n      {\n        id: 'main-gate',\n        name: 'Main Gate',\n        location: 'Powai, Eastern entrance',\n        area: 'Gate 1, Powai',\n        lat: 19.1320,\n        lng: 72.9185,\n        description: 'Primary entrance to IIT Bombay campus from Powai side.',\n        type: 'admin',\n        features: ['24/7 access', 'Security', 'Visitor registration'],\n        available: 'Security desk, visitor pass counter, vehicle entry.'\n      },\n      {\n        id: 'central-library',\n        name: 'Central Library',\n        location: 'Near Convocation Hall, Academic area',\n        area: 'Academic zone',\n        lat: 19.1345,\n        lng: 72.9110,\n        description: 'Main library with extensive print and digital collections.',\n        type: 'academic',\n        features: ['WiFi', '24/7 reading room', 'Study carrels', 'Printing'],\n        available: 'Books, journals, e-resources, study halls, printers, scanning, group study rooms.'\n      },\n      {\n        id: 'convocation-hall',\n        name: 'Convocation Hall',\n        location: 'Central academic area',\n        area: 'Academic zone',\n        lat: 19.1352,\n        lng: 72.9105,\n        description: 'Venue for convocations, lectures and large events.',\n        type: 'academic',\n        features: ['Large capacity', 'Stage', 'AV systems'],\n        available: 'Seating for 2000+, stage, projectors, sound system. Bookable for events.'\n      },\n      {\n        id: 'vmcc',\n        name: 'Victor Menezes Convention Centre (VMCC)',\n        location: 'Near Lake, Convention area',\n        area: 'Convention zone',\n        lat: 19.1360,\n        lng: 72.9080,\n        description: 'Convention centre for conferences, workshops and seminars.',\n        type: 'academic',\n        features: ['Multiple halls', 'Catering', 'WiFi', 'Parking'],\n        available: 'Auditoriums, meeting rooms, registration area, cafeteria, parking.'\n      },\n      {\n        id: 'lc',\n        name: 'Lecture Complex (LC)',\n        location: 'Academic area, near Main Building',\n        area: 'Academic zone',\n        lat: 19.1338,\n        lng: 72.9120,\n        description: 'Main lecture theatre complex for classes and exams.',\n        type: 'academic',\n        features: ['Multiple lecture halls', 'Projectors', 'Whiteboards'],\n        available: 'Lecture halls, tutorial rooms, common corridors, vending.'\n      },\n      {\n        id: 'main-building',\n        name: 'Main Building',\n        location: 'Central campus, Academic area',\n        area: 'Academic zone',\n        lat: 19.1340,\n        lng: 72.9115,\n        description: 'Central administrative and academic building.',\n        type: 'admin',\n        features: ['Admin offices', 'Dept offices', 'WiFi'],\n        available: 'Registrar, academics office, department HODs, faculty cabins, notice boards.'\n      },\n      {\n        id: 'sjmsom',\n        name: 'Shailesh J. Mehta School of Management (SJMSOM)',\n        location: 'Near Main Building',\n        area: 'Academic zone',\n        lat: 19.1332,\n        lng: 72.9108,\n        description: 'Business school offering MBA and related programmes.',\n        type: 'academic',\n        features: ['MBA programmes', 'Case study rooms', 'WiFi', 'Library'],\n        available: 'Classrooms, computer lab, library, placement cell, seminar halls.'\n      },\n      {\n        id: 'hostel-18',\n        name: 'Hostel 18',\n        location: 'Residential zone, near Powai Lake',\n        area: 'Hostel area',\n        lat: 19.1370,\n        lng: 72.9075,\n        description: 'One of the newer hostels with modern facilities.',\n        type: 'hostel',\n        features: ['Single/double rooms', 'Common room', 'WiFi', '24/7'],\n        available: 'Rooms, common room, mess, washing area, study room, gym.'\n      },\n      {\n        id: 'hostel-1',\n        name: 'Hostel 1 (First year)',\n        location: 'Residential zone',\n        area: 'Hostel area',\n        lat: 19.1315,\n        lng: 72.9095,\n        description: 'First-year undergraduate hostel.',\n        type: 'hostel',\n        features: ['Mess', 'Common room', 'WiFi'],\n        available: 'Dorm-style rooms, mess, common room, sports ground nearby.'\n      },\n      {\n        id: 'sac',\n        name: 'Student Activity Centre (SAC)',\n        location: 'Central campus, near hostels',\n        area: 'Recreation zone',\n        lat: 19.1325,\n        lng: 72.9125,\n        description: 'Hub for student clubs, activities and events.',\n        type: 'recreation',\n        features: ['Club rooms', 'Stage', 'WiFi', 'Events'],\n        available: 'Club offices, rehearsal spaces, event venue, notice boards.'\n      },\n      {\n        id: 'gymkhana',\n        name: 'Gymkhana (Sports)',\n        location: 'Sports complex area',\n        area: 'Recreation zone',\n        lat: 19.1310,\n        lng: 72.9140,\n        description: 'Sports and fitness facilities.',\n        type: 'recreation',\n        features: ['Gym', 'Indoor games', 'Courts', 'Swimming'],\n        available: 'Gym, badminton, table tennis, squash, swimming pool, outdoor courts.'\n      },\n      {\n        id: 'cafeteria',\n        name: 'Institute Cafeteria / Canteen',\n        location: 'Near SAC, Central campus',\n        area: 'Food zone',\n        lat: 19.1328,\n        lng: 72.9118,\n        description: 'Main campus canteen for meals and snacks.',\n        type: 'food',\n        features: ['Vegetarian', 'Snacks', 'Beverages'],\n        available: 'Breakfast, lunch, snacks, beverages. Open on institute timings.'\n      },\n      {\n        id: 'sine',\n        name: 'SINE (Society for Innovation & Entrepreneurship)',\n        location: 'Near Main Building',\n        area: 'Academic / Research zone',\n        lat: 19.1335,\n        lng: 72.9102,\n        description: 'Incubation centre for startups and innovation.',\n        type: 'research',\n        features: ['Incubation', 'Startup support', 'WiFi', 'Meeting rooms'],\n        available: 'Incubation space, mentoring, meeting rooms, connect with startups.'\n      },\n      {\n        id: 'cse-building',\n        name: 'Computer Science & Engineering Dept',\n        location: 'Academic area, Kanwal Rekhi Block',\n        area: 'Academic zone',\n        lat: 19.1342,\n        lng: 72.9098,\n        description: 'CSE department with labs and faculty offices.',\n        type: 'academic',\n        features: ['Labs', 'Servers', 'WiFi', 'Seminar room'],\n        available: 'Labs, project rooms, server room, faculty cabins, seminar hall.'\n      },\n      {\n        id: 'powai-lake',\n        name: 'Powai Lake (Campus side)',\n        location: 'Eastern boundary, near hostels',\n        area: 'Recreation / Nature',\n        lat: 19.1380,\n        lng: 72.9065,\n        description: 'Lake front on campus for walks and recreation.',\n        type: 'recreation',\n        features: ['Walking track', 'View', 'Open 24/7'],\n        available: 'Walking path, seating, view of lake. No swimming.'\n      }\n    ];\n\n    let map;\n    let markers = [];\n    let routeLayers = [];\n\n    function initMap() {\n      map = L.map('map', {\n        center: [IIT_CENTER.lat, IIT_CENTER.lng],\n        zoom: 16,\n        minZoom: 15,\n        maxBounds: CAMPUS_BOUNDS,\n        maxBoundsViscosity: 0.8\n      });\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n      }).addTo(map);\n      fillDirectionDropdowns();\n      bindDirectionEvents();\n      renderPlaces(campusPlaces);\n    }\n\n    function fillDirectionDropdowns() {\n      var sourceSel = document.getElementById('dirSource');\n      var destSel = document.getElementById('dirDest');\n      campusPlaces.forEach(function(p) {\n        sourceSel.appendChild(new Option(p.name, p.id));\n        destSel.appendChild(new Option(p.name, p.id));\n      });\n    }\n\n    function bindDirectionEvents() {\n      var sourceSel = document.getElementById('dirSource');\n      var destSel = document.getElementById('dirDest');\n      var clearBtn = document.getElementById('clearRouteBtn');\n      function updateRoute() {\n        var sid = sourceSel.value, did = destSel.value;\n        if (sid && did && sid !== did) {\n          var src = campusPlaces.find(function(p) { return p.id === sid; });\n          var dst = campusPlaces.find(function(p) { return p.id === did; });\n          if (src && dst) fetchAndDrawRoute(src, dst);\n        } else {\n          clearRoute();\n        }\n        clearBtn.style.display = (sid && did) ? 'inline-flex' : 'none';\n      }\n      sourceSel.addEventListener('change', updateRoute);\n      destSel.addEventListener('change', updateRoute);\n      clearBtn.addEventListener('click', function() {\n        sourceSel.value = ''; destSel.value = '';\n        clearRoute();\n        clearBtn.style.display = 'none';\n      });\n    }\n\n    function clearRoute() {\n      routeLayers.forEach(function(layer) { map.removeLayer(layer); });\n      routeLayers = [];\n    }\n\n    function fetchAndDrawRoute(source, destination) {\n      clearRoute();\n      var coords = [[source.lat, source.lng], [destination.lat, destination.lng]];\n      var apiKey = ''; // Optional: add OpenRouteService key for real routes, e.g. 'eyJvcmciOiI...'\n      var url = 'https://api.openrouteservice.org/v2/directions/driving-car/geojson';\n      var body = { coordinates: [[source.lng, source.lat], [destination.lng, destination.lat]] };\n\n      if (apiKey) {\n        fetch(url, {\n          method: 'POST',\n          headers: { 'Authorization': apiKey, 'Content-Type': 'application/json' },\n          body: JSON.stringify(body)\n        })\n          .then(function(r) { return r.json(); })\n          .then(function(data) {\n            if (data.features && data.features[0] && data.features[0].geometry)\n              coords = data.features[0].geometry.coordinates.map(function(c) { return [c[1], c[0]]; });\n            drawRouteOnMap(coords);\n          })\n          .catch(function() { drawRouteOnMap(coords); });\n      } else {\n        drawRouteOnMap(coords);\n      }\n    }\n\n    function drawRouteOnMap(coords) {\n      clearRoute();\n      var polyline = L.polyline(coords, { color: '#E07A5F', weight: 5 });\n      polyline.addTo(map);\n      routeLayers.push(polyline);\n      if (typeof L.polylineDecorator === 'function') {\n        var decorator = L.polylineDecorator(polyline, {\n          patterns: [{ offset: '5%', repeat: '10%', symbol: L.Symbol.arrowHead({ pixelSize: 8, pathOptions: { color: '#E07A5F', fillOpacity: 1 } }) }]\n        });\n        decorator.addTo(map);\n        routeLayers.push(decorator);\n      }\n      map.fitBounds(L.latLngBounds(coords), { padding: [50, 50] });\n    }\n\n    function clearMarkers() {\n      markers.forEach(m => map.removeLayer(m));\n      markers = [];\n    }\n\n    function addMarkers(places) {\n      clearMarkers();\n      places.forEach(p => {\n        const m = L.marker([p.lat, p.lng], { icon: createIcon(p.type) })\n          .addTo(map)\n          .bindPopup('<strong>' + p.name + '</strong><br>' + p.location);\n        markers.push(m);\n      });\n      if (places.length > 1) {\n        const group = L.featureGroup(markers);\n        map.fitBounds(group.getBounds().pad(0.15));\n      } else if (places.length === 1) {\n        map.setView([places[0].lat, places[0].lng], 17);\n      }\n    }\n\n    function getSearchText(place) {\n      return [place.name, place.location, place.area, place.description, place.type, (place.features || []).join(' '), place.available].filter(Boolean).join(' ').toLowerCase();\n    }\n\n    function renderPlaces(places) {\n      addMarkers(places);\n      const container = document.getElementById('placeCards');\n      const noResults = document.getElementById('noResults');\n      const countEl = document.getElementById('resultsCount');\n\n      if (places.length === 0) {\n        container.innerHTML = '';\n        noResults.style.display = 'block';\n        countEl.textContent = '0 places found.';\n        return;\n      }\n\n      noResults.style.display = 'none';\n      countEl.textContent = places.length + ' place' + (places.length !== 1 ? 's' : '') + ' found.';\n\n      const colors = { academic: '#E07A5F', hostel: '#81B29A', recreation: '#F4A261', admin: '#8B4513', food: '#3D5A40', research: '#654321' };\n      container.innerHTML = places.map(p => {\n        const feat = (p.features || []).map(f => '<span class=\"meta-pill\">' + f + '</span>').join('');\n        const color = colors[p.type] || '#6c757d';\n        return '<div class=\"place-card\" data-id=\"' + p.id + '\">' +\n          '<h3><span class=\"icon-wrap\" style=\"background:linear-gradient(135deg,' + color + ',rgba(255,255,255,0.2));\"><i class=\"fas fa-map-marker-alt\"></i></span>' + p.name + '</h3>' +\n          '<div class=\"location\"><i class=\"fas fa-location-dot\"></i> ' + p.location + '</div>' +\n          '<p class=\"desc\">' + p.description + '</p>' +\n          '<div class=\"meta\">' + feat + '</div>' +\n          '<div class=\"available-title\">What\\'s available</div>' +\n          '<div class=\"available-list\">' + p.available + '</div>' +\n          '</div>';\n      }).join('');\n\n      container.querySelectorAll('.place-card').forEach(card => {\n        card.addEventListener('click', function() {\n          const id = this.getAttribute('data-id');\n          const place = campusPlaces.find(p => p.id === id);\n          if (place) {\n            map.setView([place.lat, place.lng], 18);\n            const m = markers.find((_, i) => places[i] && places[i].id === id);\n            if (m) m.openPopup();\n          }\n        });\n      });\n    }\n\n    let currentFilter = '';\n    const searchInput = document.getElementById('searchInput');\n    const filterTags = document.querySelectorAll('.filter-tag');\n\n    function applyFilterAndSearch() {\n      const q = searchInput.value.trim().toLowerCase();\n      let list = campusPlaces;\n      if (currentFilter) list = list.filter(p => p.type === currentFilter);\n      if (q) list = list.filter(p => getSearchText(p).includes(q));\n      renderPlaces(list);\n    }\n\n    searchInput.addEventListener('input', applyFilterAndSearch);\n\n    filterTags.forEach(tag => {\n      tag.addEventListener('click', function() {\n        filterTags.forEach(t => t.classList.remove('active'));\n        this.classList.add('active');\n        currentFilter = this.getAttribute('data-filter') || '';\n        applyFilterAndSearch();\n      });\n    });\n\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', initMap);\n    } else {\n      initMap();\n    }\n  </script>\n</body>\n</html>\n";

  return (
    <iframe
      srcDoc={html}
      style={{
        width: "100%",
        height: "100vh",
        border: "none",
        display: "block",
      }}
      title="CampusMapPage"
      allow="geolocation"
    />
  );
}
