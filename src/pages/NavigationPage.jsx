import { useEffect } from "react";
import { useNavigate } from "react-router-dom";

export default function NavigationPage() {
  const navigate = useNavigate();

  useEffect(() => {
    const handleMessage = (e) => {
      if (e.data && e.data.nav) {
        navigate(e.data.nav);
      }
    };
    window.addEventListener("message", handleMessage);
    return () => window.removeEventListener("message", handleMessage);
  }, [navigate]);

  const html = "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover\">\n  <title>Smart Campus Navigation - IIT Bombay | Smart Move</title>\n  <meta name=\"theme-color\" content=\"#8B4513\">\n\n  <!-- Google Fonts (same as landing) -->\n  <link href=\"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Montserrat:wght@600;700;800&display=swap\" rel=\"stylesheet\">\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n\n  <!-- Leaflet CSS -->\n  <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" integrity=\"sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=\" crossorigin=\"\">\n  <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css\">\n\n  <style>\n    /* ==================== CUSTOM PROPERTIES (same as landing.html) ==================== */\n    :root {\n      --earth-brown: #8B4513;\n      --deep-earth: #654321;\n      --terracotta: #E07A5F;\n      --sand: #F4A261;\n      --sage: #81B29A;\n      --forest: #3D5A40;\n      --clay: #D4A574;\n      --stone: #A8A196;\n      --cream: #F9F5F0;\n      --charcoal: #2D3142;\n      --white: #FFFFFF;\n    }\n\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n      -webkit-tap-highlight-color: transparent;\n    }\n\n    body {\n      font-family: 'Poppins', sans-serif;\n      overflow-x: hidden;\n      background: #1a1a1a;\n      min-height: 100vh;\n      position: relative;\n    }\n\n    /* ==================== BACKGROUND (same as landing) ==================== */\n    .background-wrapper {\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: 0;\n      overflow: hidden;\n    }\n\n    .background-image {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      object-position: center;\n    }\n\n    .background-overlay {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(\n        135deg,\n        rgba(139, 69, 19, 0.85) 0%,\n        rgba(101, 67, 33, 0.75) 50%,\n        rgba(61, 90, 64, 0.85) 100%\n      );\n      backdrop-filter: blur(3px);\n    }\n\n    /* ==================== HEADER (same as landing) ==================== */\n    .header {\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      height: 90px;\n      background: rgba(255, 255, 255, 0.15);\n      backdrop-filter: blur(25px);\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n      z-index: 1000;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 0 50px;\n      border-bottom: 3px solid rgba(212, 165, 116, 0.3);\n    }\n\n    .logo-section {\n      display: flex;\n      align-items: center;\n      gap: 18px;\n    }\n\n    .logo-icon {\n      width: 60px;\n      height: 60px;\n      background: linear-gradient(135deg, var(--earth-brown), var(--terracotta));\n      border-radius: 15px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 8px 25px rgba(139, 69, 19, 0.5), inset 0 -3px 10px rgba(0, 0, 0, 0.3);\n      position: relative;\n    }\n\n    .logo-icon i {\n      font-size: 28px;\n      color: white;\n      filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));\n    }\n\n    .logo-text h1 {\n      font-family: 'Montserrat', sans-serif;\n      font-size: 28px;\n      font-weight: 800;\n      color: white;\n      letter-spacing: -0.5px;\n      text-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);\n      background: linear-gradient(135deg, #fff, var(--clay));\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      background-clip: text;\n    }\n\n    .logo-text p {\n      font-size: 12px;\n      color: rgba(255, 255, 255, 0.8);\n      font-weight: 600;\n      text-transform: uppercase;\n      letter-spacing: 2px;\n    }\n\n    .nav-back {\n      padding: 12px 24px;\n      background: rgba(255, 255, 255, 0.2);\n      border: 2px solid rgba(255, 255, 255, 0.4);\n      border-radius: 50px;\n      color: white;\n      font-weight: 600;\n      text-decoration: none;\n      transition: all 0.3s ease;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .nav-back:hover {\n      background: rgba(255, 255, 255, 0.3);\n      transform: translateY(-2px);\n      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);\n    }\n\n    /* ==================== MAIN CONTAINER ==================== */\n    .main-container {\n      position: relative;\n      width: 100%;\n      min-height: 100vh;\n      padding: 100px 30px 40px;\n      z-index: 1;\n    }\n\n    .map-page-title {\n      text-align: center;\n      margin-bottom: 24px;\n    }\n\n    .map-page-title h1 {\n      font-family: 'Montserrat', sans-serif;\n      font-size: 36px;\n      font-weight: 800;\n      color: white;\n      text-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);\n      margin-bottom: 8px;\n    }\n\n    .map-page-title p {\n      font-size: 16px;\n      color: rgba(255, 255, 255, 0.85);\n    }\n\n    /* ==================== GLASS CARD (same style as landing blocks) ==================== */\n    .nav-card {\n      max-width: 1100px;\n      margin: 0 auto;\n      background: rgba(255, 255, 255, 0.12);\n      backdrop-filter: blur(25px);\n      border-radius: 30px;\n      padding: 32px;\n      border: 2px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);\n    }\n\n    /* ==================== CONTROLS ==================== */\n    .controls {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12px;\n      align-items: center;\n      margin-bottom: 20px;\n    }\n\n    .input-wrap {\n      flex: 1;\n      min-width: 160px;\n      position: relative;\n    }\n\n    .input-wrap i {\n      position: absolute;\n      left: 16px;\n      top: 50%;\n      transform: translateY(-50%);\n      color: rgba(255, 255, 255, 0.7);\n      font-size: 16px;\n      pointer-events: none;\n    }\n\n    .controls input {\n      width: 100%;\n      padding: 14px 18px 14px 46px;\n      border: 2px solid rgba(255, 255, 255, 0.3);\n      border-radius: 14px;\n      background: rgba(255, 255, 255, 0.1);\n      color: white;\n      font-size: 15px;\n      font-family: 'Poppins', sans-serif;\n      transition: all 0.3s ease;\n    }\n\n    .controls input::placeholder {\n      color: rgba(255, 255, 255, 0.6);\n    }\n\n    .controls input:focus {\n      outline: none;\n      border-color: var(--terracotta);\n      background: rgba(255, 255, 255, 0.15);\n      box-shadow: 0 0 0 4px rgba(224, 122, 95, 0.2);\n    }\n\n    .btn {\n      padding: 14px 22px;\n      border: none;\n      border-radius: 14px;\n      font-size: 15px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.3s ease;\n      font-family: 'Poppins', sans-serif;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .btn-primary {\n      background: linear-gradient(135deg, var(--terracotta), var(--sand));\n      color: white;\n      box-shadow: 0 8px 25px rgba(224, 122, 95, 0.4);\n    }\n\n    .btn-primary:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 12px 35px rgba(224, 122, 95, 0.5);\n    }\n\n    .btn-secondary {\n      background: rgba(255, 255, 255, 0.2);\n      color: white;\n      border: 2px solid rgba(255, 255, 255, 0.4);\n    }\n\n    .btn-secondary:hover {\n      background: rgba(255, 255, 255, 0.3);\n      border-color: rgba(255, 255, 255, 0.6);\n      transform: translateY(-2px);\n    }\n\n    .btn-accessible {\n      background: linear-gradient(135deg, var(--sage), var(--forest));\n      color: white;\n    }\n\n    .btn-accessible:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 8px 25px rgba(129, 178, 154, 0.4);\n    }\n\n    .btn-accessible.active {\n      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);\n    }\n\n    /* ==================== MAP CONTAINER ==================== */\n    .map-wrap {\n      width: 100%;\n      height: 480px;\n      border-radius: 20px;\n      overflow: hidden;\n      border: 2px solid rgba(255, 255, 255, 0.2);\n      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);\n      background: #1a3a2a;\n    }\n\n    #map {\n      width: 100%;\n      height: 100%;\n      background: #2d5a4a;\n    }\n\n    /* Leaflet overrides for dark glass theme */\n    .leaflet-control-zoom {\n      border: 2px solid rgba(255, 255, 255, 0.3) !important;\n      border-radius: 12px !important;\n      overflow: hidden;\n    }\n\n    .leaflet-control-zoom a {\n      background: rgba(255, 255, 255, 0.15) !important;\n      color: white !important;\n      font-weight: bold !important;\n    }\n\n    .leaflet-control-zoom a:hover {\n      background: rgba(255, 255, 255, 0.3) !important;\n    }\n\n    .leaflet-routing-container {\n      background: rgba(30, 30, 30, 0.95) !important;\n      border-radius: 12px !important;\n      border: 2px solid rgba(255, 255, 255, 0.2) !important;\n    }\n\n    .leaflet-routing-container h2,\n    .leaflet-routing-container h3 {\n      color: white !important;\n    }\n\n    .leaflet-routing-alt {\n      background: rgba(255, 255, 255, 0.08) !important;\n      color: rgba(255, 255, 255, 0.9) !important;\n    }\n\n    .leaflet-control-attribution {\n      background: rgba(0, 0, 0, 0.4) !important;\n      color: rgba(255, 255, 255, 0.7) !important;\n      font-size: 10px;\n    }\n\n    /* ==================== QUICK PLACES ==================== */\n    .quick-places {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 10px;\n      margin-top: 16px;\n    }\n\n    .quick-places span {\n      font-size: 13px;\n      color: rgba(255, 255, 255, 0.8);\n      align-self: center;\n    }\n\n    .quick-btn {\n      padding: 8px 16px;\n      background: rgba(255, 255, 255, 0.1);\n      border: 1px solid rgba(255, 255, 255, 0.3);\n      border-radius: 20px;\n      color: white;\n      font-size: 13px;\n      cursor: pointer;\n      transition: all 0.25s ease;\n      font-family: 'Poppins', sans-serif;\n    }\n\n    .quick-btn:hover {\n      background: rgba(255, 255, 255, 0.2);\n      border-color: var(--terracotta);\n      transform: translateY(-1px);\n    }\n\n    /* ==================== QR & STATUS ==================== */\n    .qr-section {\n      margin-top: 20px;\n      text-align: center;\n      padding: 16px;\n      background: rgba(0, 0, 0, 0.2);\n      border-radius: 16px;\n    }\n\n    .qr-section img {\n      border-radius: 12px;\n      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);\n    }\n\n    .map-status {\n      margin-top: 12px;\n      padding: 12px 16px;\n      border-radius: 12px;\n      background: rgba(0, 0, 0, 0.2);\n      color: rgba(255, 255, 255, 0.9);\n      font-size: 14px;\n      display: none;\n    }\n\n    .map-status.show {\n      display: block;\n    }\n\n    .map-status.error {\n      background: rgba(224, 122, 95, 0.3);\n      border: 1px solid var(--terracotta);\n    }\n\n    .map-status.success {\n      background: rgba(129, 178, 154, 0.3);\n      border: 1px solid var(--sage);\n    }\n\n    /* ==================== LOADING STATE ==================== */\n    .map-loading {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-direction: column;\n      height: 100%;\n      color: white;\n      gap: 16px;\n    }\n\n    .map-loading.spinner::after {\n      content: '';\n      width: 48px;\n      height: 48px;\n      border: 4px solid rgba(255, 255, 255, 0.2);\n      border-top-color: var(--terracotta);\n      border-radius: 50%;\n      animation: spin 0.8s linear infinite;\n    }\n\n    @keyframes spin {\n      to { transform: rotate(360deg); }\n    }\n\n    /* ==================== RESPONSIVE ==================== */\n    @media (max-width: 768px) {\n      .header {\n        padding: 0 20px;\n        height: 80px;\n      }\n\n      .logo-text h1 {\n        font-size: 22px;\n      }\n\n      .main-container {\n        padding: 90px 16px 24px;\n      }\n\n      .map-page-title h1 {\n        font-size: 28px;\n      }\n\n      .nav-card {\n        padding: 20px;\n      }\n\n      .controls {\n        flex-direction: column;\n        align-items: stretch;\n      }\n\n      .input-wrap {\n        min-width: 100%;\n      }\n\n      .map-wrap {\n        height: 380px;\n      }\n    }\n  </style>\n</head>\n<body>\n\n  <div class=\"background-wrapper\">\n    <img src=\"https://images.unsplash.com/photo-1562774053-701939374585?q=80&w=2000\" alt=\"Campus\" class=\"background-image\">\n    <div class=\"background-overlay\"></div>\n  </div>\n\n  <header class=\"header\">\n    <div class=\"logo-section\">\n      <div class=\"logo-icon\">\n        <i class=\"fas fa-map-marked-alt\"></i>\n      </div>\n      <div class=\"logo-text\">\n        <h1>Smart Move</h1>\n        <p>Smart Campus Navigation</p>\n      </div>\n    </div>\n    <a href=\"#\" onclick=\"window.parent.postMessage({nav:'/landing'},'*');return false;\" class=\"nav-back\">\n      <i class=\"fas fa-arrow-left\"></i> Back to Home\n    </a>\n  </header>\n\n  <main class=\"main-container\">\n    <div class=\"map-page-title\">\n      <h1>Interactive Campus Map</h1>\n      <p>Enter start and destination, or use quick places. Map loads without any API key.</p>\n    </div>\n\n    <div class=\"nav-card\">\n      <div class=\"controls\">\n        <div class=\"input-wrap\">\n          <i class=\"fas fa-map-pin\"></i>\n          <input type=\"text\" id=\"start\" placeholder=\"Start (e.g. IIT Bombay Main Gate)\" autocomplete=\"off\">\n        </div>\n        <div class=\"input-wrap\">\n          <i class=\"fas fa-flag-checkered\"></i>\n          <input type=\"text\" id=\"end\" placeholder=\"Destination (e.g. Library IIT Bombay)\" autocomplete=\"off\">\n        </div>\n        <button type=\"button\" class=\"btn btn-primary\" id=\"btnNavigate\" onclick=\"calculateRoute()\">\n          <i class=\"fas fa-route\"></i> Navigate\n        </button>\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"btnMyLocation\" onclick=\"useMyLocation()\">\n          <i class=\"fas fa-location-crosshairs\"></i> My location\n        </button>\n        <button type=\"button\" class=\"btn btn-secondary\" onclick=\"startVoice()\">\n          <i class=\"fas fa-microphone\"></i> Voice\n        </button>\n        <button type=\"button\" class=\"btn btn-accessible\" id=\"btnAccessible\" onclick=\"toggleAccessible()\">\n          <i class=\"fas fa-universal-access\"></i> Accessible\n        </button>\n        <button type=\"button\" class=\"btn btn-secondary\" onclick=\"shareQR()\">\n          <i class=\"fas fa-qrcode\"></i> Share QR\n        </button>\n      </div>\n\n      <div class=\"quick-places\">\n        <span>Quick:</span>\n        <button type=\"button\" class=\"quick-btn\" data-place=\"IIT Bombay Main Gate\">Main Gate</button>\n        <button type=\"button\" class=\"quick-btn\" data-place=\"IIT Bombay Library\">Library</button>\n        <button type=\"button\" class=\"quick-btn\" data-place=\"IIT Bombay VMCC\">VMCC</button>\n        <button type=\"button\" class=\"quick-btn\" data-place=\"IIT Bombay Hostel 18\">Hostel 18</button>\n        <button type=\"button\" class=\"quick-btn\" data-place=\"IIT Bombay Convocation Hall\">Convocation Hall</button>\n      </div>\n\n      <div id=\"mapStatus\" class=\"map-status\"></div>\n\n      <div class=\"map-wrap\">\n        <div id=\"map\" class=\"map-loading spinner\">Loading map\u2026</div>\n      </div>\n\n      <div class=\"qr-section\" id=\"qrBox\"></div>\n    </div>\n  </main>\n\n  <!-- Leaflet JS -->\n  <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\" integrity=\"sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=\" crossorigin=\"\"></script>\n  <script src=\"https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js\"></script>\n\n  <script>\n    // IIT Bombay center\n    const IIT_BOMBAY = { lat: 19.1334, lng: 72.9133 };\n\n    let map;\n    let routingControl = null;\n    let userMarker = null;\n    let accessibleMode = false;\n\n    // Initialize map (no API key \u2013 uses OpenStreetMap)\n    function initMap() {\n      const el = document.getElementById('map');\n      el.classList.remove('map-loading', 'spinner');\n      el.innerHTML = '';\n\n      map = L.map('map').setView([IIT_BOMBAY.lat, IIT_BOMBAY.lng], 16);\n\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n        maxZoom: 19\n      }).addTo(map);\n\n      // Default marker for IIT Bombay\n      L.marker([IIT_BOMBAY.lat, IIT_BOMBAY.lng])\n        .addTo(map)\n        .bindPopup('<b>IIT Bombay</b><br>Campus center')\n        .openPopup();\n\n      showStatus('Map loaded. Enter start and destination, or use Quick places.', 'success');\n    }\n\n    function showStatus(msg, type) {\n      const el = document.getElementById('mapStatus');\n      el.textContent = msg;\n      el.className = 'map-status show ' + (type || '');\n    }\n\n    function hideStatus() {\n      document.getElementById('mapStatus').classList.remove('show');\n    }\n\n    // Geocode using Nominatim (free, no API key)\n    function geocode(query) {\n      const url = 'https://nominatim.openstreetmap.org/search?q=' + encodeURIComponent(query) + '&format=json&limit=1';\n      return fetch(url, { headers: { 'Accept': 'application/json' } })\n        .then(r => r.json())\n        .then(data => {\n          if (data && data[0]) {\n            return { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon) };\n          }\n          return null;\n        });\n    }\n\n    function clearRoute() {\n      if (routingControl) {\n        map.removeControl(routingControl);\n        routingControl = null;\n      }\n    }\n\n    function calculateRoute() {\n      const startVal = document.getElementById('start').value.trim();\n      const endVal = document.getElementById('end').value.trim();\n\n      if (!startVal || !endVal) {\n        showStatus('Please enter both start and destination.', 'error');\n        return;\n      }\n\n      showStatus('Finding route\u2026', '');\n      clearRoute();\n\n      const startInput = document.getElementById('start');\n      const startLat = startInput.dataset.lat;\n      const startLng = startInput.dataset.lng;\n      const startPromise = (startVal === 'Current location' && startLat && startLng)\n        ? Promise.resolve({ lat: parseFloat(startLat), lng: parseFloat(startLng) })\n        : geocode(startVal);\n\n      Promise.all([startPromise, geocode(endVal)])\n        .then(([startCoord, endCoord]) => {\n          if (!startCoord) {\n            showStatus('Start location not found. Try a more specific name (e.g. IIT Bombay Main Gate).', 'error');\n            return;\n          }\n          if (!endCoord) {\n            showStatus('Destination not found. Try a more specific name.', 'error');\n            return;\n          }\n\n          const start = L.latLng(startCoord.lat, startCoord.lng);\n          const end = L.latLng(endCoord.lat, endCoord.lng);\n\n          routingControl = L.Routing.control({\n            waypoints: [start, end],\n            routeWhileDragging: false,\n            show: false,\n            lineOptions: {\n              styles: [{ color: '#E07A5F', weight: 6 }],\n              addWaypoints: false\n            },\n            createMarker: function() { return null; }\n          }).addTo(map);\n\n          routingControl.on('routingerror', function() {\n            showStatus('Could not compute route for this pair. Try different places.', 'error');\n          });\n\n          routingControl.on('routesfound', function() {\n            showStatus('Route displayed. Accessible mode: ' + (accessibleMode ? 'on (walking-friendly).' : 'off.'), 'success');\n          });\n\n          speak('Route started');\n        })\n        .catch(() => {\n          showStatus('Network error. Check connection and try again.', 'error');\n        });\n    }\n\n    function useMyLocation() {\n      if (!navigator.geolocation) {\n        showStatus('Geolocation is not supported by your browser.', 'error');\n        return;\n      }\n      showStatus('Getting your location\u2026', '');\n      navigator.geolocation.getCurrentPosition(\n        function(pos) {\n          const lat = pos.coords.latitude;\n          const lng = pos.coords.longitude;\n          document.getElementById('start').value = 'Current location';\n          document.getElementById('start').dataset.lat = lat;\n          document.getElementById('start').dataset.lng = lng;\n          if (!userMarker) {\n            userMarker = L.marker([lat, lng]).addTo(map).bindPopup('You are here');\n          } else {\n            userMarker.setLatLng([lat, lng]);\n          }\n          map.setView([lat, lng], 16);\n          showStatus('Start set to your current location.', 'success');\n          speak('Location set');\n        },\n        function() {\n          showStatus('Could not get your location. Check permissions or enter start manually.', 'error');\n        }\n      );\n    }\n\n    function startVoice() {\n      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n      if (!SpeechRecognition) {\n        showStatus('Voice input not supported in this browser.', 'error');\n        return;\n      }\n      const recognition = new SpeechRecognition();\n      recognition.onresult = function(e) {\n        const speech = e.results[0][0].transcript;\n        if (!document.getElementById('start').value) {\n          document.getElementById('start').value = speech;\n        } else {\n          document.getElementById('end').value = speech;\n        }\n        speak('Location added');\n        showStatus('Voice: \"' + speech + '\" added.', 'success');\n      };\n      recognition.start();\n    }\n\n    function speak(text) {\n      const msg = new SpeechSynthesisUtterance(text);\n      speechSynthesis.speak(msg);\n    }\n\n    function toggleAccessible() {\n      accessibleMode = !accessibleMode;\n      const btn = document.getElementById('btnAccessible');\n      if (accessibleMode) {\n        btn.classList.add('active');\n        showStatus('Accessible route mode on \u2013 prefer step-free / walking routes.', 'success');\n        speak('Accessible route enabled');\n      } else {\n        btn.classList.remove('active');\n        showStatus('Normal route mode.', 'success');\n        speak('Normal route enabled');\n      }\n    }\n\n    function shareQR() {\n      const url = window.location.href;\n      document.getElementById('qrBox').innerHTML =\n        '<p style=\"color:rgba(255,255,255,0.9);margin-bottom:8px;\">Scan to open this map</p>' +\n        '<img src=\"https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=' + encodeURIComponent(url) + '\" alt=\"QR Code\">';\n    }\n\n    document.getElementById('start').addEventListener('input', function() {\n      if (this.value !== 'Current location') {\n        delete this.dataset.lat;\n        delete this.dataset.lng;\n      }\n    });\n\n    // Quick place buttons\n    document.querySelectorAll('.quick-btn').forEach(btn => {\n      btn.addEventListener('click', function() {\n        const place = this.getAttribute('data-place');\n        if (!document.getElementById('start').value) {\n          document.getElementById('start').value = place;\n        } else {\n          document.getElementById('end').value = place;\n        }\n        showStatus('Place added: ' + place, 'success');\n      });\n    });\n\n    // Load map when DOM is ready (Leaflet does not need callback like Google Maps)\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', initMap);\n    } else {\n      initMap();\n    }\n  </script>\n</body>\n</html>\n";

  return (
    <iframe
      srcDoc={html}
      style={{
        width: "100%",
        height: "100vh",
        border: "none",
        display: "block",
      }}
      title="NavigationPage"
      allow="geolocation"
    />
  );
}
